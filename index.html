<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin.ai</title>
  <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#0b0c0e; --panel:#0a0d10; --line:#1b2025; --head:#0d1115; --mono:#cfe7e7; --muted:#7d8a96; --accent:#00ffff; --accent2:#00c6c7; --ok:#36d399; --warn:#ffd166;
    }
    html,body{height:100%}
    body { margin:0; font-family:"IBM Plex Mono", monospace; background:var(--bg); color:var(--mono); display:flex; align-items:center; justify-content:center; min-height:100vh; }
    .hero-terminal { background:var(--panel); border:1px solid var(--line); border-radius:12px; overflow:hidden; width:92%; max-width:900px; box-shadow:0 10px 40px rgba(0,0,0,.35); }
    .term-head { display:flex; align-items:center; gap:8px; padding:10px 12px; border-bottom:1px solid #151a1f; background:var(--head); }
    .dot { width:10px; height:10px; border-radius:50%; background:#2a2f35; }
    .badge { font-size:11px; color:var(--muted); border:1px solid #262c33; padding:4px 8px; border-radius:6px; display:inline-block; }
    .term-body { font-size:14px; padding:14px 16px; white-space:pre-wrap; line-height:1.35; max-height:360px; overflow-y:auto; }
    .row{ display:flex; gap:8px; align-items:baseline; margin:0 0 4px; }
    .ts{ color:#80919a; opacity:.85; font-size:12px; }
    .prompt{ color:var(--accent2); }
    .ok{ color:var(--ok); }
    .warn{ color:var(--warn); }
    .caret{ display:inline-block; width:8px; height:1.05em; background:var(--accent); vertical-align:-2px; animation:blink 1.1s steps(1) infinite; }
    @keyframes blink{ 50%{ opacity:0 } }
  </style>
</head>
<body>
  <div class="hero-terminal" id="term">
    <div class="term-head">
      <span class="dot"></span><span class="dot"></span><span class="dot"></span>
      <span class="badge">/usr/local/admin/orchestrator</span>
    </div>
    <div class="term-body" id="out" aria-label="terminal example"></div>
  </div>

  <script>
    const out = document.getElementById('out');

    // utils
    const rnd = (min,max)=> Math.floor(Math.random()*(max-min+1))+min;
    const pick = arr => arr[rnd(0,arr.length-1)];
    const hex = n => [...crypto.getRandomValues(new Uint8Array(n))].map(b=>b.toString(16).padStart(2,'0')).join('').slice(0,n);

    // channels
    const MODES = [
      {k:'voice', open: sid=>`$ channel/open voice SID:${sid}`, ready:'v2t on • stream'},
      {k:'video', open: sid=>`$ channel/open video SID:${sid}`, ready:'v2t+mm on • stream'},
      {k:'chat',  open: sid=>`$ channel/open chat  SID:${sid}`, ready:'nlp on • live'}
    ];

    // dx + actions
    const ICD10 = ['R07.9','E11.9','I10','J45.909','F32.9','N39.0','J18.9'];
    const ICHI_POOL = ['NA31.RX','PA45.LB','QA60.OB','RA05.EV','KB40.US','WA90.FU'];
    const actionsFor = code => pick(ICHI_POOL) + ' ' + pick(ICHI_POOL);
    const rxIdsFor = code => (['J45.909','N39.0','J18.9','E11.9','I10'].includes(code)
      ? { product:`RX-${hex(4)}`, dose:`DOSE-${hex(3)}` } : null);

    // timestamps
    const pad=(n,w=2)=> String(n).padStart(w,'0');
    const ts=()=>{ const d=new Date(); return `${pad(d.getHours())}:${pad(d.getMinutes())}:${pad(d.getSeconds())}.${pad(d.getMilliseconds(),3)}`; };

    // typing + delays
    const speed = rnd(8,14); // per-char typing speed
    const MAX_ROWS = 15;
    function delayForType(type){
      switch(type){
        case 'boot': return rnd(900,1600); // slower boot to feel like thinking
        case 'prompt': return rnd(90,160);
        case 'fast': return rnd(50,110);
        case 'normal': return rnd(150,260);
        case 'slow': return rnd(700,1300);
        default: return rnd(150,260);
      }
    }

    function span(cls){ const s=document.createElement('span'); if(cls) s.className=cls; return s; }
    function printLine(text, isPrompt, extraClass, type){
      const row = document.createElement('div'); row.className = 'row';
      row.appendChild(span('ts')).textContent = ts();
      if(isPrompt){ row.appendChild(span('prompt')).textContent = '$ '; }
      const content = document.createElement('span'); if(extraClass) content.className = extraClass; row.appendChild(content);
      out.appendChild(row);
      while(out.children.length > MAX_ROWS){ out.removeChild(out.firstChild); }
      out.scrollTop = out.scrollHeight;
      return new Promise(resolve=>{ let i=0; const tick=()=>{ if(i<text.length){ content.textContent += text.charAt(i++); setTimeout(tick, speed); } else resolve(); }; tick(); })
        .then(()=> new Promise(r=>setTimeout(r, delayForType(type))));
    }

    // phase 0: short boot + minimal sessions
    function buildShortSession(idx){
      const sid = String(idx).padStart(2,'0');
      const pid = rnd(80000,99999);
      const payer = rnd(10,99);
      const ehr = rnd(20,59);
      const mode = pick(MODES);
      const code = pick(ICD10);
      const rx = rxIdsFor(code);
      const qa = `quality/${rnd(1,40)}`;
      const cln = `clinician/${rnd(1,40)}`;
      const adm = `admin/${rnd(1,40)}`;
      const rcm = `rcm/${rnd(1,40)}`;

      const ev = [];
      ev.push({t:mode.open(sid), p:true, type:'prompt'});
      ev.push({t:mode.ready, p:false, type:'fast'});
      ev.push({t:`$ orchestrator spawn ${cln} ${adm} ${qa} ${rcm} PID:${pid}`, p:true, type:'prompt'});
      ev.push({t:`agents ready`, p:false, type:'fast'});
      ev.push({t:`$ ${cln} finalize ${code}`, p:true, type:'prompt'});
      ev.push({t:`actions • ${actionsFor(code)}`, p:false, type:'normal'});
      ev.push({t:`$ ${qa} QA diag`, p:true, type:'prompt'});
      ev.push({t:`${code} • rationale ok`, p:false, cls:'ok', type:'fast'});
      if(rx){
        ev.push({t:`$ rx/${rnd(1,40)} e-script ${rx.product} ${rx.dose}`, p:true, type:'prompt'});
        ev.push({t:`checks pass`, p:false, cls:'ok', type:'normal'});
      }
      ev.push({t:`$ ${adm} commit EHR:ID${ehr}`, p:true, type:'prompt'});
      ev.push({t:`note+orders saved`, p:false, type:'slow'});
      ev.push({t:`$ ${rcm} claim code ${code} → payer:ID${payer}`, p:true, type:'prompt'});
      ev.push({t:`ack ${rnd(40,95)}ms • pending`, p:false, type:'slow'});
      return ev;
    }

    function genPhase0(){
      const sessions = rnd(1,2);
      const ev = [];
      // longer boot sequence to feel real
      ev.push({t:`$ orchestrator boot --sessions ${sessions}`, p:true, type:'boot'});
      ev.push({t:`init: runtime • schedulers • network`, p:false, type:'boot'});
      ev.push({t:`load: patient-context • healthcare-context`, p:false, type:'boot'});
      ev.push({t:`health: connectors ok • policy-set mounted`, p:false, type:'boot'});
      ev.push({t:`cluster online • patient channels active`, p:false, type:'fast'});
      for(let i=1;i<=sessions;i++) ev.push(...buildShortSession(i));
      ev.push({t:'$ status cluster', p:true, type:'prompt'});
      ev.push({t:`sessions:${sessions} • QA:100% • latency<100ms • SLA>99.9%`, p:false, cls:'ok', type:'normal'});
      ev.push({t:'$', p:true, hold:true, type:'prompt'});
      return ev;
    }

    // continuation chunks appended after hold
    function genContinueChunk(){
      const chunk = [];
      // remove old hold later; here we just produce more activity
      // randomly resolve a pending claim
      if(Math.random() < 0.6){
        const jid = `jid-${hex(6)}`;
        chunk.push({t:`$ automation/watch ${jid} target:PAYER:ID${rnd(10,99)}`, p:true, type:'prompt'});
        if(Math.random() < 0.3){ chunk.push({t:`${jid} upstream latency ${rnd(800,2200)}ms`, p:false, cls:'warn', type:'slow'}); }
        chunk.push({t:`${jid} ERA posted • remit ok`, p:false, cls:'ok', type:'normal'});
      }
      // start one more brief session
      const sid = rnd(3,9);
      const mode = pick(MODES);
      const code = pick(ICD10);
      const qa = `quality/${rnd(1,40)}`;
      chunk.push({t:mode.open(String(sid).padStart(2,'0')), p:true, type:'prompt'});
      chunk.push({t:mode.ready, p:false, type:'fast'});
      chunk.push({t:`$ clinician/${rnd(1,40)} finalize ${code}`, p:true, type:'prompt'});
      chunk.push({t:`$ ${qa} QA diag`, p:true, type:'prompt'});
      chunk.push({t:`${code} • rationale ok`, p:false, cls:'ok', type:'fast'});
      // status roll-up
      chunk.push({t:'$ status cluster', p:true, type:'prompt'});
      chunk.push({t:`sessions:${rnd(1,3)} • QA:100% • latency<${rnd(80,140)}ms • SLA>99.9%`, p:false, cls:'ok', type:'normal'});
      // end with new prompt
      chunk.push({t:'$', p:true, hold:true, type:'prompt'});
      return chunk;
    }

    let running = false;
    let phase = 0;

    async function render(lines, append=false){
      if(running) return;
      running = true;
      if(!append){ out.innerHTML = ''; }
      // if appending, remove existing caret so we can continue
      if(append && out.lastChild){
        const last = out.lastChild.querySelector('.caret');
        if(last) last.remove();
      }
      for(const line of lines){
        await printLine(line.t, line.p, line.cls, line.type);
        if(line.hold){ const c=document.createElement('span'); c.className='caret'; out.lastChild.appendChild(c); out.scrollTop = out.scrollHeight; }
      }
      running = false;
    }

    function start(){ phase = 0; render(genPhase0(), false); }
    function cont(){ phase += 1; render(genContinueChunk(), true); }

    start();

    // Desktop: Enter continues; Mobile/coarse: tap continues
    const isCoarse = window.matchMedia && window.matchMedia('(pointer: coarse)').matches;
    if(isCoarse){
      document.addEventListener('pointerdown', ()=>{ if(!running) cont(); }, {passive:true});
    } else {
      document.addEventListener('keydown', (e)=>{ if(e.key === 'Enter' && !running){ cont(); } });
    }
  </script>
</body>
</html>
